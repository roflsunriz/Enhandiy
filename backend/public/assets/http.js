const p={Accept:"application/json","X-Requested-With":"XMLHttpRequest"};function T(){const e=window.config?.csrf_token;if(e)return e;const n=document.getElementById("csrfToken");if(n&&n.value)return n.value;const o=document.querySelector('meta[name="csrf-token"]');return o&&o.content?o.content:""}function w(r,e,n){return new Promise((o,a)=>{const u=setTimeout(()=>{a(new Error("Request timeout"))},n);fetch(r,e).then(c=>{clearTimeout(u),o(c)}).catch(c=>{clearTimeout(u),a(c)})})}async function d(r,e={}){const{method:n="GET",headers:o={},body:a,timeout:u=1e4}=e,c={...p,...o};a&&typeof a=="string"&&(c["Content-Type"]="application/json");const f=T();f&&(c["X-CSRF-Token"]=f);try{const t=await w(r,{method:n,headers:c,body:a},u),m=t.headers.get("Content-Type")||"";if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);if(m.includes("application/json")){const i=await t.json();if(typeof i=="object"&&i!==null&&"status"in i){const s=i;if(s.status==="success")return{success:!0,data:s.data,message:s.message};const l=[s.message,s.hint,s.error_id?`(ID: ${s.error_id})`:void 0].filter(Boolean).join(" ");return{success:!1,error:s.error_code||l,message:s.message}}return i}return{success:!0,data:await t.text()}}catch(t){return console.error("Request failed:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}function h(r,e){return d(r,{method:"GET",headers:e})}function y(r,e,n){const o=e instanceof FormData?e:JSON.stringify(e);return d(r,{method:"POST",body:o,headers:n})}export{T as a,h as g,y as p,d as r};
