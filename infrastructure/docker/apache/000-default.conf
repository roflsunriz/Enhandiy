<VirtualHost *:80>
    DocumentRoot /var/www/html/backend/public
    ServerName localhost

    # フロントエンドアセットへのエイリアス
    Alias /frontend/dist /var/www/html/frontend/dist
    <Directory /var/www/html/frontend/dist>
        Options FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>

    # APIエンドポイントへのエイリアス
    Alias /api /var/www/html/backend/api
    <Directory /var/www/html/backend/api>
        Options FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php
    </Directory>

    # .htaccessの処理を有効にする
    <Directory /var/www/html/backend/public>
        Options FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php index.html
        
        # Tus.io用のリライトルール（直接設定）
        RewriteEngine On
        
        # Tus.ioアップロードIDをGETパラメータとして処理
        RewriteCond %{REQUEST_METHOD} ^(PATCH|HEAD)$
        RewriteCond %{REQUEST_URI} ^/api/tus-upload\.php/(.+)$
        RewriteRule ^/api/tus-upload\.php/(.+)$ ../api/tus-upload.php?upload_id=%1 [QSA,L]
        
        # PATH_INFOの代替処理
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^/api/tus-upload\.php/(.+)$ ../api/tus-upload.php?upload_id=$1 [QSA,L]
    </Directory>

    # エラーログの設定
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
    
    # PHPの設定
    php_admin_value display_errors Off
    php_admin_value log_errors On
</VirtualHost>