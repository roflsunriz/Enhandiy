import{r as h,i as u}from"./errorHandling.js";import{a as f}from"./api-client.js";import{p}from"./http.js";class g{currentFolderId=null;constructor(){this.init()}init(){const e=new URLSearchParams(window.location.search);this.currentFolderId=e.get("folder")||null,this.setupEventListeners(),this.loadFolderOptions()}setupEventListeners(){this.bindCreateFolderButton(),document.addEventListener("click",e=>{const r=e.target;if(r.classList.contains("rename-folder")){e.preventDefault();const o=r.dataset.folderId;o&&this.showRenameFolderDialog(o)}if(r.classList.contains("move-folder")){e.preventDefault();const o=r.dataset.folderId;o&&this.showMoveFolderDialog(o)}if(r.classList.contains("delete-folder")){e.preventDefault();const o=r.dataset.folderId;o&&this.showDeleteFolderDialog(o)}})}bindCreateFolderButton(){const e=document.getElementById("create-folder-btn");e?(e.addEventListener("click",()=>this.showCreateFolderDialog()),console.log("Create folder button bound")):(console.log("Create folder button not found, retrying in 500ms"),setTimeout(()=>this.bindCreateFolderButton(),500))}async loadFolderOptions(){try{const e=await f.getFolders();this.updateFolderSelect(e.data||[])}catch(e){console.error("ãƒ•ã‚©ãƒ«ãƒ€èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",e)}}updateFolderSelect(e){const r=document.getElementById("folder-select");if(!r)return;const o=r.value;r.innerHTML='<option value="">ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€</option>';const t=(s,a=0)=>{s.forEach(n=>{const c=document.createElement("option");c.value=n.id,c.textContent="ã€€".repeat(a)+n.name,r.appendChild(c);const l=n;"children"in n&&l.children&&l.children.length>0&&t(l.children,a+1)})};t(e),r.value=o}showCreateFolderDialog(){const e=window.prompt("æ–°ã—ã„ãƒ•ã‚©ãƒ«ãƒ€åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:");!e||!e.trim()||this.createFolder(e.trim(),this.currentFolderId)}async createFolder(e,r=null){try{await f.createFolder(e,r||void 0),alert("ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã¾ã—ãŸ: "+e),window.location.reload()}catch(o){console.error("ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆã‚¨ãƒ©ãƒ¼:",o);const t=o instanceof Error?o.message:"ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ";alert("ã‚¨ãƒ©ãƒ¼: "+t)}}showRenameFolderDialog(e){const r=document.querySelector(`[data-folder-id="${e}"] .folder-item`),o=r?r.textContent?.trim().replace("ğŸ“","").trim():"",t=window.prompt("æ–°ã—ã„ãƒ•ã‚©ãƒ«ãƒ€åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:",o);!t||!t.trim()||t.trim()===o||this.renameFolder(e,t.trim())}async renameFolder(e,r){try{await f.updateFolder(e,r),alert("ãƒ•ã‚©ãƒ«ãƒ€åã‚’å¤‰æ›´ã—ã¾ã—ãŸ: "+r),window.location.reload()}catch(o){console.error("ãƒ•ã‚©ãƒ«ãƒ€åå¤‰æ›´ã‚¨ãƒ©ãƒ¼:",o);const t=o instanceof Error?o.message:"ãƒ•ã‚©ãƒ«ãƒ€åå¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸ";alert("ã‚¨ãƒ©ãƒ¼: "+t)}}async showMoveFolderDialog(e){try{const o=(await f.getFolders()).data||[];let t=`ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã™ã‚‹å ´åˆã¯ã€Œrootã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

åˆ©ç”¨å¯èƒ½ãªãƒ•ã‚©ãƒ«ãƒ€:
`;const s=(c,l=0)=>{c.forEach(i=>{i.id!==e&&(t+="ã€€".repeat(l)+`${i.id}: ${i.name}
`);const d=i;"children"in i&&d.children&&d.children.length>0&&s(d.children,l+1)})};s(o);const a=window.prompt(t+`
ç§»å‹•å…ˆã®ãƒ•ã‚©ãƒ«ãƒ€IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:`);if(a===null)return;const n=a.toLowerCase()==="root"?null:a;this.moveFolder(e,n)}catch(r){console.error("ãƒ•ã‚©ãƒ«ãƒ€ç§»å‹•ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚¨ãƒ©ãƒ¼:",r);const o=r instanceof Error?r.message:"ãƒ•ã‚©ãƒ«ãƒ€ç§»å‹•ã®æº–å‚™ã«å¤±æ•—ã—ã¾ã—ãŸ";alert("ã‚¨ãƒ©ãƒ¼: "+o)}}async moveFolder(e,r){try{console.warn("ãƒ•ã‚©ãƒ«ãƒ€ç§»å‹•æ©Ÿèƒ½ã¯æœªå®Ÿè£…ã§ã™",{folderId:e,newParentId:r}),alert("ãƒ•ã‚©ãƒ«ãƒ€ç§»å‹•æ©Ÿèƒ½ã¯ç¾åœ¨å®Ÿè£…ä¸­ã§ã™ã€‚");return}catch(o){console.error("ãƒ•ã‚©ãƒ«ãƒ€ç§»å‹•ã‚¨ãƒ©ãƒ¼:",o);const t=o instanceof Error?o.message:"ãƒ•ã‚©ãƒ«ãƒ€ç§»å‹•ã«å¤±æ•—ã—ã¾ã—ãŸ";alert("ã‚¨ãƒ©ãƒ¼: "+t)}}async showDeleteFolderDialog(e){const r=document.querySelector(`[data-folder-id="${e}"] .folder-item`),o=r?r.textContent?.trim().replace("ğŸ“","").trim():"ãƒ•ã‚©ãƒ«ãƒ€";try{const s=(await f.getFolderFileCount(e)).data?.count||0,a=0;if(s===0&&a===0)confirm(`ãƒ•ã‚©ãƒ«ãƒ€ã€Œ${o}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)&&this.deleteFolder(e,!1);else{let n=`ãƒ•ã‚©ãƒ«ãƒ€ã€Œ${o}ã€ã«ã¯ä»¥ä¸‹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š
`;s>0&&(n+=`ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«: ${s}å€‹
`),a>0,n+=`
å‰Šé™¤æ–¹æ³•ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼š
`,n+=`ã€ŒOKã€= ä¸­èº«ã‚’ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã—ã¦å‰Šé™¤
`,n+="ã€Œã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€= å‰Šé™¤ã‚’ä¸­æ­¢",confirm(n)&&this.deleteFolder(e,!0)}}catch(t){console.error("ãƒ•ã‚©ãƒ«ãƒ€å‰Šé™¤ç¢ºèªã‚¨ãƒ©ãƒ¼:",t);const s=t instanceof Error?t.message:"ãƒ•ã‚©ãƒ«ãƒ€æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ";alert("ã‚¨ãƒ©ãƒ¼: "+s)}}async deleteFolder(e,r=!1){try{const o=await f.deleteFolder(e);if(o.success)alert("ãƒ•ã‚©ãƒ«ãƒ€ã‚’å‰Šé™¤ã—ã¾ã—ãŸ");else throw new Error(o.error||"ãƒ•ã‚©ãƒ«ãƒ€å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ");window.location.reload()}catch(o){console.error("ãƒ•ã‚©ãƒ«ãƒ€å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",o);const t=o instanceof Error?o.message:"ãƒ•ã‚©ãƒ«ãƒ€å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ";alert("ã‚¨ãƒ©ãƒ¼: "+t)}}}async function w(m){const e=window.config;if(!e||!e.folders_enabled){alert("ãƒ•ã‚©ãƒ«ãƒ€æ©Ÿèƒ½ãŒç„¡åŠ¹ã«ãªã£ã¦ã„ã¾ã™ã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");return}try{const o=(await f.getFolders()).data||[];let t=`ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã™ã‚‹å ´åˆã¯ã€Œrootã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

åˆ©ç”¨å¯èƒ½ãªãƒ•ã‚©ãƒ«ãƒ€:
`;const s=(c,l=0)=>{c.forEach(i=>{t+="ã€€".repeat(l)+`${i.id}: ${i.name}
`;const d=i;"children"in i&&d.children&&d.children.length>0&&s(d.children,l+1)})};s(o);const a=window.prompt(t+`
ç§»å‹•å…ˆã®ãƒ•ã‚©ãƒ«ãƒ€IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:`);if(a===null)return;const n=a.toLowerCase()==="root"?null:a;await p("./app/api/move-file.php",{file_id:m,folder_id:n}),alert("ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç§»å‹•ã—ã¾ã—ãŸ"),window.location.reload()}catch(r){console.error("ãƒ•ã‚¡ã‚¤ãƒ«ç§»å‹•ã‚¨ãƒ©ãƒ¼:",r);const o=r instanceof Error?r.message:"ãƒ•ã‚¡ã‚¤ãƒ«ç§»å‹•ã«å¤±æ•—ã—ã¾ã—ãŸ";alert("ã‚¨ãƒ©ãƒ¼: "+o)}}h(()=>{console.log("Folder Manager functionality initialized (TypeScript)"),u();const m=window.config;if(m&&m.folders_enabled){const e=new g;window.folderManager=e,console.log("SimpleFolderManager initialized")}else console.log("Folder functionality is disabled or config not available")});window.moveFile=w;
