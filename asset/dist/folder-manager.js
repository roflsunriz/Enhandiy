import{r as u,i as w}from"./errorHandling.js";import{g as p,p as m,a as h,d as g}from"./http.js";class F{currentFolderId=null;constructor(){this.init()}init(){const r=new URLSearchParams(window.location.search);this.currentFolderId=r.get("folder")||null,this.setupEventListeners(),this.loadFolderOptions()}setupEventListeners(){const r=document.getElementById("create-folder-btn");r&&r.addEventListener("click",()=>this.showCreateFolderDialog()),document.addEventListener("click",t=>{const o=t.target;if(o.classList.contains("rename-folder")){t.preventDefault();const e=o.dataset.folderId;e&&this.showRenameFolderDialog(e)}if(o.classList.contains("move-folder")){t.preventDefault();const e=o.dataset.folderId;e&&this.showMoveFolderDialog(e)}if(o.classList.contains("delete-folder")){t.preventDefault();const e=o.dataset.folderId;e&&this.showDeleteFolderDialog(e)}})}async loadFolderOptions(){try{const r=await p("./app/api/folders.php");this.updateFolderSelect(r.folders||[])}catch(r){console.error("ãƒ•ã‚©ãƒ«ãƒ€èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",r)}}updateFolderSelect(r){const t=document.getElementById("folder-select");if(!t)return;const o=t.value;t.innerHTML='<option value="">ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€</option>';const e=(a,s=0)=>{a.forEach(n=>{const d=document.createElement("option");d.value=n.id,d.textContent="ã€€".repeat(s)+n.name,t.appendChild(d);const i=n;"children"in n&&i.children&&i.children.length>0&&e(i.children,s+1)})};e(r),t.value=o}showCreateFolderDialog(){const r=window.prompt("æ–°ã—ã„ãƒ•ã‚©ãƒ«ãƒ€åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:");!r||!r.trim()||this.createFolder(r.trim(),this.currentFolderId)}async createFolder(r,t=null){try{await m("./app/api/folders.php",{name:r,parent_id:t}),alert("ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã¾ã—ãŸ: "+r),window.location.reload()}catch(o){console.error("ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆã‚¨ãƒ©ãƒ¼:",o);const e=o instanceof Error?o.message:"ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ";alert("ã‚¨ãƒ©ãƒ¼: "+e)}}showRenameFolderDialog(r){const t=document.querySelector(`[data-folder-id="${r}"] .folder-item`),o=t?t.textContent?.trim().replace("ğŸ“","").trim():"",e=window.prompt("æ–°ã—ã„ãƒ•ã‚©ãƒ«ãƒ€åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:",o);!e||!e.trim()||e.trim()===o||this.renameFolder(r,e.trim())}async renameFolder(r,t){try{await h("./app/api/folders.php",{id:r,name:t}),alert("ãƒ•ã‚©ãƒ«ãƒ€åã‚’å¤‰æ›´ã—ã¾ã—ãŸ: "+t),window.location.reload()}catch(o){console.error("ãƒ•ã‚©ãƒ«ãƒ€åå¤‰æ›´ã‚¨ãƒ©ãƒ¼:",o);const e=o instanceof Error?o.message:"ãƒ•ã‚©ãƒ«ãƒ€åå¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸ";alert("ã‚¨ãƒ©ãƒ¼: "+e)}}async showMoveFolderDialog(r){try{const o=(await p("./app/api/folders.php")).folders||[];let e=`ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã™ã‚‹å ´åˆã¯ã€Œrootã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

åˆ©ç”¨å¯èƒ½ãªãƒ•ã‚©ãƒ«ãƒ€:
`;const a=(d,i=0)=>{d.forEach(l=>{l.id!==r&&(e+="ã€€".repeat(i)+`${l.id}: ${l.name}
`);const f=l;"children"in l&&f.children&&f.children.length>0&&a(f.children,i+1)})};a(o);const s=window.prompt(e+`
ç§»å‹•å…ˆã®ãƒ•ã‚©ãƒ«ãƒ€IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:`);if(s===null)return;const n=s.toLowerCase()==="root"?null:s;this.moveFolder(r,n)}catch(t){console.error("ãƒ•ã‚©ãƒ«ãƒ€ç§»å‹•ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚¨ãƒ©ãƒ¼:",t);const o=t instanceof Error?t.message:"ãƒ•ã‚©ãƒ«ãƒ€ç§»å‹•ã®æº–å‚™ã«å¤±æ•—ã—ã¾ã—ãŸ";alert("ã‚¨ãƒ©ãƒ¼: "+o)}}async moveFolder(r,t){try{await h("./app/api/folders.php",{id:r,parent_id:t}),alert("ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç§»å‹•ã—ã¾ã—ãŸ"),window.location.reload()}catch(o){console.error("ãƒ•ã‚©ãƒ«ãƒ€ç§»å‹•ã‚¨ãƒ©ãƒ¼:",o);const e=o instanceof Error?o.message:"ãƒ•ã‚©ãƒ«ãƒ€ç§»å‹•ã«å¤±æ•—ã—ã¾ã—ãŸ";alert("ã‚¨ãƒ©ãƒ¼: "+e)}}async showDeleteFolderDialog(r){const t=document.querySelector(`[data-folder-id="${r}"] .folder-item`),o=t?t.textContent?.trim().replace("ğŸ“","").trim():"ãƒ•ã‚©ãƒ«ãƒ€";try{const e=await p(`./app/api/folders.php?id=${r}&check=true`),a=e.file_count||0,s=e.child_count||0;if(a===0&&s===0)confirm(`ãƒ•ã‚©ãƒ«ãƒ€ã€Œ${o}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)&&this.deleteFolder(r,!1);else{let n=`ãƒ•ã‚©ãƒ«ãƒ€ã€Œ${o}ã€ã«ã¯ä»¥ä¸‹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š
`;a>0&&(n+=`ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«: ${a}å€‹
`),s>0&&(n+=`ãƒ»å­ãƒ•ã‚©ãƒ«ãƒ€: ${s}å€‹
`),n+=`
å‰Šé™¤æ–¹æ³•ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼š
`,n+=`ã€ŒOKã€= ä¸­èº«ã‚’ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã—ã¦å‰Šé™¤
`,n+="ã€Œã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€= å‰Šé™¤ã‚’ä¸­æ­¢",confirm(n)&&this.deleteFolder(r,!0)}}catch(e){console.error("ãƒ•ã‚©ãƒ«ãƒ€å‰Šé™¤ç¢ºèªã‚¨ãƒ©ãƒ¼:",e);const a=e instanceof Error?e.message:"ãƒ•ã‚©ãƒ«ãƒ€æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ";alert("ã‚¨ãƒ©ãƒ¼: "+a)}}async deleteFolder(r,t=!1){try{const o=`./app/api/folders.php?id=${r}${t?"&move_files=true":""}`,e=await g(o);t&&e.moved_files&&e.moved_files>0?alert(`ãƒ•ã‚©ãƒ«ãƒ€ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚
${e.moved_files}å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã—ã¾ã—ãŸã€‚`):alert("ãƒ•ã‚©ãƒ«ãƒ€ã‚’å‰Šé™¤ã—ã¾ã—ãŸ"),window.location.reload()}catch(o){console.error("ãƒ•ã‚©ãƒ«ãƒ€å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",o);const e=o instanceof Error?o.message:"ãƒ•ã‚©ãƒ«ãƒ€å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ";alert("ã‚¨ãƒ©ãƒ¼: "+e)}}}async function y(c){if(!window.folderManager){alert("ãƒ•ã‚©ãƒ«ãƒ€ãƒãƒãƒ¼ã‚¸ãƒ£ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“");return}try{const t=(await p("./app/api/folders.php")).folders||[];let o=`ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã™ã‚‹å ´åˆã¯ã€Œrootã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

åˆ©ç”¨å¯èƒ½ãªãƒ•ã‚©ãƒ«ãƒ€:
`;const e=(n,d=0)=>{n.forEach(i=>{o+="ã€€".repeat(d)+`${i.id}: ${i.name}
`;const l=i;"children"in i&&l.children&&l.children.length>0&&e(l.children,d+1)})};e(t);const a=window.prompt(o+`
ç§»å‹•å…ˆã®ãƒ•ã‚©ãƒ«ãƒ€IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:`);if(a===null)return;const s=a.toLowerCase()==="root"?null:a;await m("./app/api/move-file.php",{file_id:c,folder_id:s}),alert("ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç§»å‹•ã—ã¾ã—ãŸ"),window.location.reload()}catch(r){console.error("ãƒ•ã‚¡ã‚¤ãƒ«ç§»å‹•ã‚¨ãƒ©ãƒ¼:",r);const t=r instanceof Error?r.message:"ãƒ•ã‚¡ã‚¤ãƒ«ç§»å‹•ã«å¤±æ•—ã—ã¾ã—ãŸ";alert("ã‚¨ãƒ©ãƒ¼: "+t)}}u(()=>{if(console.log("Folder Manager functionality initialized (TypeScript)"),w(),document.getElementById("folder-grid")||document.getElementById("folder-select")){const c=new F;window.folderManager=c}});window.moveFile=y;
