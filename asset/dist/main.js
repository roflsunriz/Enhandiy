import{r as f,i as m,e as u}from"./errorHandling.js";import{F as w}from"./FileManager.js";import{s as r,h as l,i as M}from"./bootstrap.js";function g(e,n,i,t){let o;switch(e){case"okcansel":o="OKCanselModal",s(o,n,i),t&&c(o,t),r(o);break;case"ok":o="OKModal",s(o,n,i),t&&c(o,t),r(o);break;default:console.error("Unknown modal type:",e)}}function p(){l("OKCanselModal"),l("OKModal")}function s(e,n,i){const t=document.getElementById(e);if(!t)return;const o=t.querySelector(".modal-title");o&&(o.innerHTML=d(n));const a=t.querySelector(".modal-body p");a&&(a.innerHTML=d(i))}function c(e,n){const i=document.getElementById(e);if(!i)return;const t=i.querySelector(".f-action");if(!t)return;const o=t.cloneNode(!0);t.parentNode?.replaceChild(o,t),typeof n=="function"?o.addEventListener("click",n):typeof n=="string"&&o.setAttribute("onclick",n)}function d(e){const n=document.createElement("div");return n.textContent=e,n.innerHTML}typeof window<"u"&&(window.openModal=g,window.closeModal=p);f(()=>{console.log("PHPUploader v2.0 - Modern TypeScript Edition"),m(),M(),y(),h(),k()});function y(){const e=document.getElementById("fileManagerContainer");if(window.fileData&&e){console.log("Initializing new FileManager v2.0");const n=new w(e,{itemsPerPage:12,defaultSort:"date_desc"});n.setFiles(window.fileData),window.fileManagerInstance=n,console.log("FileManager initialized successfully")}else S()}function h(){const e=document.getElementById("statusMessage");e&&setTimeout(()=>{e.style.opacity="0",setTimeout(()=>{e.style.display="none"},300)},5e3)}function k(){const n=new URLSearchParams(window.location.search).get("error");if(n){let i="",t="エラー";switch(n){case"expired":t="共有リンクエラー",i="この共有リンクは有効期限が切れています。";break;case"limit_exceeded":t="ダウンロード制限エラー",i="このファイルは最大ダウンロード数に達しているため、ダウンロードできません。";break;default:i="不明なエラーが発生しました。";break}u(`${t}: ${i}`,"error"),E()}}function E(){if(window.history&&window.history.replaceState){const e=window.location.pathname+window.location.search.replace(/[?&]error=[^&]*/,"").replace(/^&/,"?");window.history.replaceState({},document.title,e)}}function S(){console.error("❌ FileManager initialization failed: missing container or data"),u("ファイル一覧の表示に問題があります。ページを再読み込みしてください。","error")}
