import{r as f,i as m,e as u}from"./errorHandling.js";import{F as w}from"./FileManager.js";import{s as r,h as l,i as M}from"./bootstrap.js";import"./http.js";function g(e,t,i,n){let o;switch(e){case"okcansel":o="OKCanselModal",s(o,t,i),n&&c(o,n),r(o);break;case"ok":o="OKModal",s(o,t,i),n&&c(o,n),r(o);break;default:console.error("Unknown modal type:",e)}}function p(){l("OKCanselModal"),l("OKModal")}function s(e,t,i){const n=document.getElementById(e);if(!n)return;const o=n.querySelector(".modal-title");o&&(o.innerHTML=d(t));const a=n.querySelector(".modal-body p");a&&(a.innerHTML=d(i))}function c(e,t){const i=document.getElementById(e);if(!i)return;const n=i.querySelector(".f-action");if(!n)return;const o=n.cloneNode(!0);n.parentNode?.replaceChild(o,n),typeof t=="function"?o.addEventListener("click",t):typeof t=="string"&&o.setAttribute("onclick",t)}function d(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}typeof window<"u"&&(window.openModal=g,window.closeModal=p);f(()=>{console.log("PHPUploader v2.0 - Modern TypeScript Edition"),m(),M(),y(),h(),k()});function y(){const e=document.getElementById("fileManagerContainer");if(window.fileData&&e){console.log("Initializing new FileManager v2.0");const t=new w(e,{itemsPerPage:12,defaultSort:"date_desc"});t.setFiles(window.fileData),window.fileManagerInstance=t,console.log("FileManager initialized successfully")}else S()}function h(){const e=document.getElementById("statusMessage");e&&setTimeout(()=>{e.style.opacity="0",setTimeout(()=>{e.style.display="none"},300)},5e3)}function k(){const t=new URLSearchParams(window.location.search).get("error");if(t){let i="",n="エラー";switch(t){case"expired":n="共有リンクエラー",i="この共有リンクは有効期限が切れています。";break;case"limit_exceeded":n="ダウンロード制限エラー",i="このファイルは最大ダウンロード数に達しているため、ダウンロードできません。";break;default:i="不明なエラーが発生しました。";break}u(`${n}: ${i}`,"error"),E()}}function E(){if(window.history&&window.history.replaceState){const e=window.location.pathname+window.location.search.replace(/[?&]error=[^&]*/,"").replace(/^&/,"?");window.history.replaceState({},document.title,e)}}function S(){console.error("❌ FileManager initialization failed: missing container or data"),u("ファイル一覧の表示に問題があります。ページを再読み込みしてください。","error")}
