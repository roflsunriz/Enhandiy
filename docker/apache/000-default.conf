<VirtualHost *:80>
    DocumentRoot /var/www/html
    ServerName localhost

    # .htaccessの処理を有効にする
    <Directory /var/www/html>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Tus.io用のリライトルール（直接設定）
        RewriteEngine On
        
        # Tus.ioアップロードIDをGETパラメータとして処理
        RewriteCond %{REQUEST_METHOD} ^(PATCH|HEAD)$
        RewriteCond %{REQUEST_URI} ^/app/api/tus-upload\.php/(.+)$
        RewriteRule ^app/api/tus-upload\.php/(.+)$ /app/api/tus-upload.php?upload_id=%1 [QSA,L]
        
        # PATH_INFOの代替処理
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^app/api/tus-upload\.php/(.+)$ /app/api/tus-upload.php?upload_id=$1 [QSA,L]
    </Directory>

    # エラーログの設定
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
    
    # PHPの設定
    php_admin_value display_errors Off
    php_admin_value log_errors On
</VirtualHost>