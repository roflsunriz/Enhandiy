# phpUploader v3.4.0-roflsunriz リリースノート

## 🐛 修正された問題

### 弱いパスワード自動拒否機能の改善

この重要なセキュリティ修正により、弱いパスワードの検出・拒否機能が大幅に強化されました。

#### 修正内容

**🔧 パスワード検証の完全修正**
- 以前のバージョンでは、WEAK_PASSWORDSリストに含まれる"test"、"password"等の弱いパスワードがアップロード時に正しく拒否されていませんでした
- フォーム送信時の検証ロジックがHTMLフォーム送信イベントに依存していたため、実際のTUS（resumable upload）経由のアップロードでは検証が動作していませんでした

**🔍 大文字小文字バリエーション完全対応**
- "test"（小文字）
- "TEST"（大文字）
- "TeSt"（大文字小文字混在）
- その他全ての大文字小文字バリエーション

上記すべてのパターンが確実に検出・拒否されるようになりました。

**⚡ アップロード時検証の強化**
- パスワード強度チェックを`getUploadOptions`関数に移動し、実際のアップロード開始前に確実に検証を実行
- `resumable-upload.ts`と`drag-drop.ts`の両方のアップロード経路で一貫した検証を実装

**🎨 UI/UX体験の大幅改善**
- 弱いパスワードでアップロードが拒否された際に、従来の「通信エラーが発生しました。しばらく後に再試行してください。」という意味のないメッセージから、「削除キーが弱すぎます。より複雑なキーを設定してください。」という明確で有用なメッセージに改善
- 統合モーダルでの適切なエラー表示により、ユーザーが問題を理解して適切に対処できるように
- コンソールログのみの不親切なエラーハンドリングから、ユーザーフレンドリーなエラー体験に刷新

## 🔐 セキュリティ強化

**堅牢な認証システム**
- 弱いパスワードのあらゆるバリエーションを完全に阻止
- アップロード開始前の確実な検証によりセキュリティホールを封鎖
- UIでの警告表示とバックエンドでの拒否の二重チェック体制

## 📋 技術的詳細

**変更されたファイル**
- `src/password-strength.ts` - パスワード強度チェック関数の改善
- `src/resumable-upload.ts` - TUSアップロードでの検証追加
- `src/drag-drop.ts` - ドラッグ&ドロップアップロードでの検証追加

**検証フロー**
1. ユーザーがパスワードを入力
2. リアルタイムUI警告（既存機能）
3. アップロードボタン押下時に`getUploadOptions`関数で検証
4. 弱いパスワードが検出された場合、エラーを発生させアップロードを停止

## 🧪 テスト結果

**確認済み動作**
- ✅ "test" → 正しく拒否
- ✅ "TEST" → 正しく拒否
- ✅ "TeSt" → 正しく拒否
- ✅ "password" → 正しく拒否
- ✅ その他WEAK_PASSWORDSリストの全項目 → 正しく拒否
- ✅ アップロード完全停止の確認
- ✅ 適切なエラーメッセージ表示の確認

## 🎯 対象ユーザー

この修正により、以下の方にメリットがあります：

- **セキュリティを重視するサイト運営者**: より堅牢なパスワードポリシーの実現
- **既存ユーザー**: セキュリティホールの完全修正
- **新規ユーザー**: 最初から安全なアップロード環境

## 🚀 アップグレード方法

1. 最新版をダウンロード・デプロイ
2. ブラウザキャッシュをクリア（重要：JavaScript更新反映のため）
3. 弱いパスワードでのアップロードテストで動作確認

## ⚠️ 重要な注意事項

- 既存の弱いパスワードで保護されたファイルには影響しません（後方互換性維持）
- 新規アップロード時のみより厳格なパスワードポリシーが適用されます
- ブラウザキャッシュクリアを忘れずに行ってください

---

**リリース日**: 2025年8月6日  
**バージョン**: v3.4.0-roflsunriz  
**リリースタイプ**: セキュリティ修正  

このリリースにより、phpUploaderはより安全で信頼性の高いファイルアップロードシステムとなりました。

ご利用いただき、ありがとうございます！ 🛡️